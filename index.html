<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚‚ã—ã‚‚ãƒœãƒƒã‚¯ã‚¹AI | Parallel Universe Simulator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React, ReactDOM, Babel for Browser-side JSX -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #05070a;
            color: #f1f5f9;
        }
        .animate-spin-slow {
            animation: spin 30s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- Lucide Icon Component Helper ---
        const Icon = ({ name, size = 24, className = "", fill = "none" }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const apiKey = ""; // Runtime provides the key

        const App = () => {
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);
            const [worldData, setWorldData] = useState(null);
            const [error, setError] = useState(null);
            const [images, setImages] = useState({});
            const [generatingImages, setGeneratingImages] = useState({});

            const categories = [
                { id: 'politics', label: 'æ”¿æ²»', icon: 'âš–ï¸' },
                { id: 'economy', label: 'çµŒæ¸ˆ', icon: 'ğŸ“ˆ' },
                { id: 'medical', label: 'åŒ»ç™‚', icon: 'ğŸ¥' },
                { id: 'education', label: 'æ•™è‚²', icon: 'ğŸ“' },
                { id: 'lifestyle', label: 'è¡£é£Ÿä½', icon: 'ğŸ ' },
                { id: 'energy', label: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼', icon: 'âš¡' },
                { id: 'sports', label: 'ã‚¹ãƒãƒ¼ãƒ„', icon: 'ğŸ†' },
                { id: 'music', label: 'éŸ³æ¥½', icon: 'ğŸµ' },
                { id: 'romance', label: 'æ‹æ„›', icon: 'â¤ï¸' }
            ];

            const suggestions = [
                "ã‚‚ã—ã‚‚ã€ãƒ†ãƒ¬ãƒ‘ã‚·ãƒ¼ãŒæ™®åŠã—ã¦ã„ãŸã‚‰ï¼Ÿ",
                "ã‚‚ã—ã‚‚ã€ãƒãƒ–ãƒ«ãŒå´©å£Šã—ã¦ã„ãªã‘ã‚Œã°ï¼Ÿ",
                "ã‚‚ã—ã‚‚ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒå­˜åœ¨ã—ãªã‹ã£ãŸã‚‰ï¼Ÿ",
                "ã‚‚ã—ã‚‚ã€äººé–“ã®å¯¿å‘½ãŒ30æ­³ã¾ã§ã ã£ãŸã‚‰ï¼Ÿ"
            ];

            const generateImage = async (id, prompt) => {
                setGeneratingImages(prev => ({ ...prev, [id]: true }));
                let retries = 0;
                const maxRetries = 5;

                while (retries < maxRetries) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                instances: [{ prompt: `Photorealistic, high quality, cinematic scene showing: ${prompt}. Cinematic lighting, 8k resolution.` }],
                                parameters: { sampleCount: 1 }
                            })
                        });

                        if (!response.ok) throw new Error("Image Generation Failed");

                        const result = await response.json();
                        const base64 = result.predictions[0].bytesBase64Encoded;
                        
                        setImages(prev => ({ ...prev, [id]: `data:image/png;base64,${base64}` }));
                        setGeneratingImages(prev => ({ ...prev, [id]: false }));
                        return;
                    } catch (err) {
                        retries++;
                        await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                    }
                }
                setGeneratingImages(prev => ({ ...prev, [id]: false }));
            };

            const generateWorld = async (userPrompt) => {
                setLoading(true);
                setError(null);
                setImages({});
                setWorldData(null);

                const systemPrompt = `
                  ã‚ãªãŸã¯ã€Œã‚‚ã—ã‚‚ãƒœãƒƒã‚¯ã‚¹AIã€ã§ã™ã€‚æ­´å²ã®åˆ†å²ç‚¹ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ä¸¦è¡Œä¸–ç•Œã®2026å¹´ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚
                  
                  å‡ºåŠ›ã¯ä»¥ä¸‹ã®JSONå½¢å¼ã§ã€æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
                  {
                    "realityDeviation": number (0-100),
                    "worldSummary": "ã“ã®ä¸–ç•Œã®çŠ¶æ…‹ã®çŸ­ã„è¦ç´„",
                    "categories": {
                      "politics": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "economy": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "medical": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "education": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "lifestyle": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "energy": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "sports": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "music": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" },
                      "romance": { "content": "å†…å®¹", "imagePrompt": "English prompt for image generation" }
                    },
                    "topics": [
                      { "title": "ãƒˆãƒ”ãƒƒã‚¯å", "detail": "è©³ç´°æ–‡ï¼ˆ300æ–‡å­—ç¨‹åº¦ï¼‰", "imagePrompt": "English prompt for image generation" },
                      { "title": "ãƒˆãƒ”ãƒƒã‚¯å", "detail": "è©³ç´°æ–‡ï¼ˆ300æ–‡å­—ç¨‹åº¦ï¼‰", "imagePrompt": "English prompt for image generation" },
                      { "title": "ãƒˆãƒ”ãƒƒã‚¯å", "detail": "è©³ç´°æ–‡ï¼ˆ300æ–‡å­—ç¨‹åº¦ï¼‰", "imagePrompt": "English prompt for image generation" }
                    ]
                  }

                  ãƒ«ãƒ¼ãƒ«ï¼š
                  - 9ã¤ã®ã‚«ãƒ†ã‚´ãƒªã™ã¹ã¦ã«å¯¾ã—ã¦ã€å…·ä½“çš„ã§ãƒªã‚¢ãƒªãƒ†ã‚£ã®ã‚ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
                  - ãƒˆãƒ”ãƒƒã‚¯ã‚¹ã¯2026å¹´ã®å‡ºæ¥äº‹ã¨ã—ã¦å…·ä½“çš„ã‹ã¤ç‰©èªçš„ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
                `;

                const payload = {
                    contents: [{ parts: [{ text: `ã€Œã‚‚ã—ã‚‚ã€${userPrompt}ã€ã¨ã„ã†è¨­å®šã§ã€2026å¹´ã®ä¸¦è¡Œä¸–ç•Œã‚’ç”Ÿæˆã—ã¦ã€‚` }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: { responseMimeType: "application/json" }
                };

                let retries = 0;
                const maxRetries = 5;

                while (retries < maxRetries) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) throw new Error("API Request Failed");

                        const result = await response.json();
                        const data = JSON.parse(result.candidates[0].content.parts[0].text);
                        
                        setWorldData(data);
                        setLoading(false);

                        Object.keys(data.categories).forEach(catId => {
                            generateImage(catId, data.categories[catId].imagePrompt);
                        });
                        data.topics.forEach((topic, idx) => {
                            generateImage(`topic_${idx}`, topic.imagePrompt);
                        });

                        return;
                    } catch (err) {
                        retries++;
                        if (retries === maxRetries) {
                            setError("é‡å­å ´ãŒä¸å®‰å®šã§æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚");
                            setLoading(false);
                        } else {
                            await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                        }
                    }
                }
            };

            const handleSumbit = (e) => {
                e.preventDefault();
                if (!input.trim()) return;
                generateWorld(input);
            };

            const SkeletonImage = () => (
                <div className="w-full h-56 bg-slate-800/50 animate-pulse rounded-t-3xl flex items-center justify-center">
                    <Icon name="cpu" size={32} className="text-slate-700 animate-spin" />
                </div>
            );

            return (
                <div className="min-h-screen text-slate-100 flex flex-col overflow-x-hidden">
                    {/* Dynamic Background */}
                    <div className="fixed inset-0 pointer-events-none -z-10 overflow-hidden">
                        <div className="absolute top-[-5%] left-[-10%] w-[50%] h-[50%] bg-cyan-900/10 blur-[120px] rounded-full"></div>
                        <div className="absolute bottom-[-5%] right-[-10%] w-[50%] h-[50%] bg-blue-900/10 blur-[120px] rounded-full"></div>
                    </div>

                    <header className="border-b border-white/5 bg-slate-950/80 backdrop-blur-3xl sticky top-0 z-50 flex-shrink-0">
                        <div className="max-w-6xl mx-auto px-6 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3 group cursor-pointer" onClick={() => { setWorldData(null); setInput(""); }}>
                                <div className="bg-cyan-600 p-1.5 rounded-lg shadow-[0_0_15px_rgba(6,182,212,0.4)] transition-transform group-hover:scale-110">
                                    <Icon name="zap" size={18} className="text-white" />
                                </div>
                                <h1 className="text-lg font-black tracking-tight">ã‚‚ã—ã‚‚ãƒœãƒƒã‚¯ã‚¹<span className="text-cyan-500">AI</span></h1>
                            </div>
                            <div className="hidden md:block text-[9px] font-mono text-slate-500 uppercase tracking-[0.2em] bg-white/5 px-3 py-1 rounded-full border border-white/5">
                                Temporal Reality Engine v3.7
                            </div>
                        </div>
                    </header>

                    <main className={`max-w-6xl mx-auto px-6 flex-grow flex flex-col ${!worldData && !loading ? 'justify-center overflow-hidden h-[calc(100vh-60px)]' : 'py-10'}`}>
                        {!worldData && !loading ? (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-1000 w-full max-w-4xl mx-auto flex flex-col items-center">
                                <div className="mb-4 p-4 bg-cyan-500/5 rounded-full border border-cyan-500/10 shadow-2xl">
                                    <Icon name="globe" size={48} className="text-cyan-500 animate-spin-slow" />
                                </div>
                                <h2 className="text-3xl md:text-5xl font-black mb-3 tracking-tight text-white leading-tight text-center">
                                    æ­´å²ã®åˆ†å²ç‚¹ã‚’è¦³æ¸¬ã™ã‚‹
                                </h2>
                                <p className="text-slate-400 mb-6 max-w-2xl mx-auto text-base md:text-lg text-center leading-snug">
                                    ã‚ãªãŸã®ã€Œã‚‚ã—ã‚‚ã€ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã€ã‚‚ã†ä¸€ã¤ã®2026å¹´ã‚’<br className="hidden md:block"/>
                                    é«˜åº¦ãªé‡å­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å¯è¦–åŒ–ã—ã¾ã™ã€‚
                                </p>
                                
                                <form onSubmit={handleSumbit} className="relative w-full max-w-2xl mb-8 group">
                                    <div className="absolute -inset-1 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-[2rem] blur opacity-15 group-hover:opacity-30 transition duration-700"></div>
                                    <input 
                                        type="text"
                                        value={input}
                                        onChange={(e) => setInput(e.target.value)}
                                        placeholder="ã‚‚ã—ã‚‚ã€â—‹â—‹ã ã£ãŸã‚‰ï¼Ÿ"
                                        className="relative w-full bg-slate-900/90 border border-white/10 rounded-[2rem] px-8 py-5 text-lg focus:outline-none focus:border-cyan-500 transition-all shadow-xl"
                                    />
                                    <button 
                                        type="submit"
                                        className="absolute right-2.5 top-2.5 bottom-2.5 bg-cyan-600 hover:bg-cyan-500 text-white px-8 rounded-2xl transition-all flex items-center justify-center shadow-lg active:scale-95 font-black text-base"
                                    >
                                        è¦³æ¸¬é–‹å§‹ <Icon name="send" size={18} className="ml-2" />
                                    </button>
                                </form>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-left w-full max-w-2xl">
                                    {suggestions.map((suggestion, i) => (
                                        <button 
                                            key={i}
                                            onClick={() => setInput(suggestion)}
                                            className="p-3.5 bg-slate-900/40 border border-white/5 rounded-2xl hover:border-cyan-500/30 transition-all text-xs md:text-sm text-slate-400 flex items-center justify-between group hover:bg-slate-800/60"
                                        >
                                            <span className="font-medium truncate">{suggestion}</span>
                                            <Icon name="chevron-right" size={16} className="text-slate-700 group-hover:text-cyan-500 transition-colors flex-shrink-0 ml-2" />
                                        </button>
                                    ))}
                                </div>
                            </div>
                        ) : loading ? (
                            <div className="flex-grow flex flex-col items-center justify-center">
                                <div className="relative mb-10">
                                    <div className="w-32 h-32 border-[5px] border-cyan-500/10 border-t-cyan-500 rounded-full animate-spin"></div>
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <Icon name="cpu" size={48} className="text-cyan-500 animate-pulse" />
                                    </div>
                                </div>
                                <h3 className="text-2xl font-black text-white mb-2">æ™‚ç©ºã®å†æ§‹æˆä¸­</h3>
                                <p className="text-slate-500 font-mono text-xs tracking-[0.4em] uppercase text-center">Simulating Parallel Realities</p>
                            </div>
                        ) : (
                            <div className="animate-in fade-in duration-1000 pb-20">
                                <div className="bg-gradient-to-br from-slate-900 to-[#0d1117] border border-white/10 rounded-[3rem] p-8 md:p-12 mb-12 shadow-2xl flex flex-col md:flex-row items-center gap-8 md:gap-14 relative overflow-hidden">
                                   <div className="absolute top-0 right-0 p-12 opacity-[0.03] pointer-events-none scale-150">
                                     <Icon name="layout-grid" size={240} />
                                   </div>
                                   <div className="flex-shrink-0 text-center md:text-left relative z-10">
                                      <div className="text-sm font-black text-cyan-500 uppercase tracking-[0.3em] mb-2">Reality Deviation</div>
                                      <div className="text-7xl font-black text-white font-mono leading-none">{worldData.realityDeviation}<span className="text-3xl ml-1">%</span></div>
                                   </div>
                                   <div className="h-px md:h-24 w-full md:w-px bg-white/10"></div>
                                   <div className="flex-1 relative z-10">
                                      <h3 className="text-xs font-bold text-slate-500 uppercase tracking-[0.3em] mb-4 flex items-center gap-2">
                                        <Icon name="info" size={16} className="text-cyan-600" /> 2026å¹´ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¦‚æ³
                                      </h3>
                                      <p className="text-2xl md:text-3xl font-bold leading-tight text-slate-100">
                                        {worldData.worldSummary}
                                      </p>
                                   </div>
                                </div>

                                <div className="flex items-end justify-between mb-8 px-2">
                                   <h4 className="text-base font-black text-white uppercase tracking-[0.4em] border-l-4 border-cyan-600 pl-4">åˆ†é‡åˆ¥è§£æ</h4>
                                   <span className="text-slate-600 text-[10px] font-mono">SECTOR ANALYSIS</span>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20">
                                  {categories.map((cat) => (
                                    <div key={cat.id} className="bg-slate-900/30 border border-white/5 rounded-[2.5rem] overflow-hidden hover:border-cyan-500/40 transition-all flex flex-col group shadow-xl">
                                      {images[cat.id] ? (
                                        <img src={images[cat.id]} alt={cat.label} className="w-full h-56 object-cover group-hover:scale-110 transition-transform duration-1000" />
                                      ) : <SkeletonImage />}
                                      <div className="p-8 flex-1">
                                        <div className="flex items-center gap-3 mb-4">
                                          <span className="text-2xl">{cat.icon}</span>
                                          <span className="font-black text-lg text-white tracking-tight">{cat.label}</span>
                                        </div>
                                        <p className="text-lg text-slate-300 leading-relaxed font-medium">
                                          {worldData.categories[cat.id]?.content || "ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­..."}
                                        </p>
                                      </div>
                                    </div>
                                  ))}
                                </div>

                                <div className="flex items-end justify-between mb-8 px-2">
                                   <h4 className="text-base font-black text-white uppercase tracking-[0.4em] border-l-4 border-orange-600 pl-4">ä¸»è¦ãƒˆãƒ”ãƒƒã‚¯ã‚¹</h4>
                                   <span className="text-slate-600 text-[10px] font-mono">CRITICAL EVENTS</span>
                                </div>

                                <div className="space-y-12 mb-20">
                                  {worldData.topics.map((topic, idx) => (
                                    <div key={idx} className="bg-slate-900/20 border border-white/5 rounded-[3.5rem] p-6 md:p-10 flex flex-col lg:flex-row gap-10 items-start group overflow-hidden relative shadow-2xl">
                                      <div className="w-full lg:w-[360px] aspect-square overflow-hidden rounded-[2.5rem] shadow-2xl flex-shrink-0">
                                        {images[`topic_${idx}`] ? (
                                          <img src={images[`topic_${idx}`]} alt={topic.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000" />
                                        ) : <SkeletonImage />}
                                      </div>
                                      <div className="flex-1 pt-4">
                                        <div className="inline-block bg-orange-600/10 text-orange-500 text-[10px] font-black px-4 py-1 rounded-full border border-orange-600/20 mb-5 uppercase tracking-[0.2em]">
                                          TOPIC OBSERVED #{idx + 1}
                                        </div>
                                        <h5 className="text-3xl md:text-4xl font-black text-white mb-6 group-hover:text-cyan-400 transition-colors leading-tight">{topic.title}</h5>
                                        <p className="text-xl md:text-2xl text-slate-300 leading-relaxed font-medium">
                                          {topic.detail}
                                        </p>
                                      </div>
                                      <div className="absolute -bottom-10 -right-10 text-white/[0.02] pointer-events-none">
                                        <Icon name="lightbulb" size={240} />
                                      </div>
                                    </div>
                                  ))}
                                </div>
                                
                                <button 
                                  onClick={() => { setWorldData(null); setInput(""); setImages({}); }}
                                  className="w-full py-10 border-4 border-dashed border-white/10 rounded-[3rem] text-slate-500 font-black text-lg uppercase tracking-[0.3em] hover:text-cyan-400 hover:border-cyan-500/50 hover:bg-cyan-500/5 transition-all flex items-center justify-center gap-4 group"
                                >
                                  <Icon name="refresh-cw" size={24} className="group-hover:rotate-180 transition-transform duration-1000 mr-4" /> æ–°ã—ã„ã€Œã‚‚ã—ã‚‚ã€ã‚’è¦³æ¸¬
                                </button>
                            </div>
                        )}

                        {error && (
                            <div className="mt-8 p-6 bg-red-500/5 border border-red-500/20 rounded-[2rem] text-red-400 flex items-center gap-5 shadow-2xl">
                                <Icon name="alert-triangle" size={28} />
                                <div className="text-lg font-bold">{error}</div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÇÇ„Åó„ÇÇ„Éú„ÉÉ„ÇØ„ÇπAI | Parallel Universe Simulator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React, ReactDOM, Babel for Browser-side JSX -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #05070a;
            color: #f1f5f9;
            overflow-x: hidden;
        }
        .animate-spin-slow {
            animation: spin 30s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- Lucide Icon Component Helper (FIXED for removeChild error) ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                // lucide.createIcons() replaces elements, which confuses React's reconciliation.
                // By using innerHTML inside a ref-managed span, we keep React's DOM management separate from Lucide's.
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = `<i data-lucide="${name}" style="width: ${size}px; height: ${size}px" class="${className}"></i>`;
                    window.lucide.createIcons({
                        attrs: {
                            'stroke-width': 2,
                        },
                        nameAttr: 'data-lucide'
                    });
                }
            }, [name, size, className]);

            return <span ref={containerRef} className="inline-flex items-center justify-center"></span>;
        };

        const apiKey = "AIzaSyAQ_wUdZeEF3i-BkHMGh7bnLIPXWvN6BC8"; 

        const App = () => {
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);
            const [worldData, setWorldData] = useState(null);
            const [error, setError] = useState(null);
            const [images, setImages] = useState({});
            const [generatingImages, setGeneratingImages] = useState({});

            const categories = [
                { id: 'politics', label: 'ÊîøÊ≤ª', icon: '‚öñÔ∏è' },
                { id: 'economy', label: 'ÁµåÊ∏à', icon: 'üìà' },
                { id: 'medical', label: 'ÂåªÁôÇ', icon: 'üè•' },
                { id: 'education', label: 'ÊïôËÇ≤', icon: 'üéì' },
                { id: 'lifestyle', label: 'Ë°£È£ü‰Ωè', icon: 'üè†' },
                { id: 'energy', label: '„Ç®„Éç„É´„ÇÆ„Éº', icon: '‚ö°' },
                { id: 'sports', label: '„Çπ„Éù„Éº„ÉÑ', icon: 'üèÜ' },
                { id: 'music', label: 'Èü≥Ê•Ω', icon: 'üéµ' },
                { id: 'romance', label: 'ÊÅãÊÑõ', icon: '‚ù§Ô∏è' }
            ];

            const suggestions = [
                "„ÇÇ„Åó„ÇÇ„ÄÅ„ÉÜ„É¨„Éë„Ç∑„Éº„ÅåÊôÆÂèä„Åó„Å¶„ÅÑ„Åü„ÇâÔºü",
                "„ÇÇ„Åó„ÇÇ„ÄÅ„Éê„Éñ„É´„ÅåÂ¥©Â£ä„Åó„Å¶„ÅÑ„Å™„Åë„Çå„Å∞Ôºü",
                "„ÇÇ„Åó„ÇÇ„ÄÅ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„Éà„ÅåÂ≠òÂú®„Åó„Å™„Åã„Å£„Åü„ÇâÔºü",
                "„ÇÇ„Åó„ÇÇ„ÄÅ‰∫∫Èñì„ÅÆÂØøÂëΩ„Åå30Ê≠≥„Åæ„Åß„Å†„Å£„Åü„ÇâÔºü"
            ];

            const generateImage = async (id, prompt) => {
                setGeneratingImages(prev => ({ ...prev, [id]: true }));
                let retries = 0;
                const maxRetries = 5;

                while (retries < maxRetries) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                instances: [{ prompt: `Photorealistic, high quality, cinematic scene showing: ${prompt}. Cinematic lighting, 8k resolution.` }],
                                parameters: { sampleCount: 1 }
                            })
                        });

                        if (!response.ok) throw new Error("Image Generation Failed");

                        const result = await response.json();
                        const base64 = result.predictions?.[0]?.bytesBase64Encoded;
                        
                        if (base64) {
                            setImages(prev => ({ ...prev, [id]: `data:image/png;base64,${base64}` }));
                        }
                        setGeneratingImages(prev => ({ ...prev, [id]: false }));
                        return;
                    } catch (err) {
                        retries++;
                        await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                    }
                }
                setGeneratingImages(prev => ({ ...prev, [id]: false }));
            };

            const generateWorld = async (userPrompt) => {
                setLoading(true);
                setError(null);
                setImages({});
                setWorldData(null);

                const systemPrompt = `„ÅÇ„Å™„Åü„ÅØ„Äå„ÇÇ„Åó„ÇÇ„Éú„ÉÉ„ÇØ„ÇπAI„Äç„Åß„Åô„ÄÇÊ≠¥Âè≤„ÅÆÂàÜÂ≤êÁÇπ„Åã„ÇâÁîü„Åæ„Çå„Çã‰∏¶Ë°å‰∏ñÁïå„ÅÆ2026Âπ¥„Çí„Ç∑„Éü„É•„É¨„Éº„Éà„Åó„Åæ„Åô„ÄÇ
ÂøÖ„ÅöÊåáÂÆö„Åï„Çå„ÅüJSONÂΩ¢Âºè„ÅßÂõûÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

                const payload = {
                    contents: [{ parts: [{ text: `„Äå„ÇÇ„Åó„ÇÇ„ÄÅ${userPrompt}„Äç„Å®„ÅÑ„ÅÜË®≠ÂÆö„Åß„ÄÅ2026Âπ¥„ÅÆ‰∏¶Ë°å‰∏ñÁïå„ÇíÁîüÊàê„Åó„Å¶„ÄÇ` }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: { 
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                realityDeviation: { type: "NUMBER" },
                                worldSummary: { type: "STRING" },
                                categories: {
                                    type: "OBJECT",
                                    properties: {
                                        politics: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        economy: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        medical: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        education: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        lifestyle: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        energy: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        sports: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        music: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } },
                                        romance: { type: "OBJECT", properties: { content: { type: "STRING" }, imagePrompt: { type: "STRING" } } }
                                    }
                                },
                                topics: {
                                    type: "ARRAY",
                                    items: {
                                        type: "OBJECT",
                                        properties: {
                                            title: { type: "STRING" },
                                            detail: { type: "STRING" },
                                            imagePrompt: { type: "STRING" }
                                        }
                                    }
                                }
                            }
                        }
                    }
                };

                let retries = 0;
                const maxRetries = 5;

                while (retries < maxRetries) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) throw new Error(`API Request Failed with status ${response.status}`);

                        const result = await response.json();
                        const rawText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        
                        if (!rawText) throw new Error("No content received from AI");

                        const jsonMatch = rawText.match(/\{[\s\S]*\}/);
                        if (!jsonMatch) throw new Error("JSON structure not found in AI response");
                        
                        const data = JSON.parse(jsonMatch[0]);
                        
                        setWorldData(data);
                        setLoading(false);

                        Object.keys(data.categories).forEach(catId => {
                            if (data.categories[catId]?.imagePrompt) {
                                generateImage(catId, data.categories[catId].imagePrompt);
                            }
                        });
                        data.topics.forEach((topic, idx) => {
                            if (topic.imagePrompt) {
                                generateImage(`topic_${idx}`, topic.imagePrompt);
                            }
                        });

                        return;
                    } catch (err) {
                        retries++;
                        console.error("Attempt " + retries + " error:", err);
                        if (retries === maxRetries) {
                            setError(`ÊôÇÁ©∫„ÅÆË¶≥Ê∏¨„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÈáèÂ≠êÂ†¥„Åå‰∏çÂÆâÂÆö„Åß„Åô„ÄÇ\n„Ç®„É©„ÉºË©≥Á¥∞: ${err.message}`);
                            setLoading(false);
                        } else {
                            await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                        }
                    }
                }
            };

            const handleSumbit = (e) => {
                e.preventDefault();
                if (!input.trim() || loading) return;
                generateWorld(input);
            };

            const SkeletonImage = () => (
                <div className="w-full h-56 bg-slate-800/50 animate-pulse rounded-t-3xl flex items-center justify-center">
                    <Icon name="cpu" size={32} className="text-slate-700 animate-spin" />
                </div>
            );

            return (
                <div className="min-h-screen text-slate-100 flex flex-col">
                    <div className="fixed inset-0 pointer-events-none -z-10 overflow-hidden">
                        <div className="absolute top-[-5%] left-[-10%] w-[50%] h-[50%] bg-cyan-900/10 blur-[120px] rounded-full"></div>
                        <div className="absolute bottom-[-5%] right-[-10%] w-[50%] h-[50%] bg-blue-900/10 blur-[120px] rounded-full"></div>
                    </div>

                    <header className="border-b border-white/5 bg-slate-950/80 backdrop-blur-3xl sticky top-0 z-50 flex-shrink-0">
                        <div className="max-w-6xl mx-auto px-6 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3 group cursor-pointer" onClick={() => { setWorldData(null); setInput(""); setError(null); setLoading(false); }}>
                                <div className="bg-cyan-600 p-1.5 rounded-lg shadow-[0_0_15px_rgba(6,182,212,0.4)] transition-transform group-hover:scale-110">
                                    <Icon name="zap" size={18} className="text-white" />
                                </div>
                                <h1 className="text-lg font-black tracking-tight">„ÇÇ„Åó„ÇÇ„Éú„ÉÉ„ÇØ„Çπ<span className="text-cyan-500">AI</span></h1>
                            </div>
                            <div className="hidden md:block text-[9px] font-mono text-slate-500 uppercase tracking-[0.2em] bg-white/5 px-3 py-1 rounded-full border border-white/5">
                                Temporal Reality Engine v3.8
                            </div>
                        </div>
                    </header>

                    <main className={`max-w-6xl mx-auto px-6 flex-grow flex flex-col ${!worldData && !loading ? 'justify-center overflow-hidden h-[calc(100vh-60px)]' : 'py-10'}`}>
                        {!worldData && !loading ? (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-1000 w-full max-w-4xl mx-auto flex flex-col items-center">
                                <div className="mb-4 p-4 bg-cyan-500/5 rounded-full border border-cyan-500/10 shadow-2xl">
                                    <Icon name="globe" size={48} className="text-cyan-500 animate-spin-slow" />
                                </div>
                                <h2 className="text-3xl md:text-5xl font-black mb-3 tracking-tight text-white leading-tight text-center">
                                    Ê≠¥Âè≤„ÅÆÂàÜÂ≤êÁÇπ„ÇíË¶≥Ê∏¨„Åô„Çã
                                </h2>
                                <p className="text-slate-400 mb-6 max-w-2xl mx-auto text-base md:text-lg text-center leading-snug">
                                    „ÅÇ„Å™„Åü„ÅÆ„Äå„ÇÇ„Åó„ÇÇ„Äç„Åã„ÇâÁîü„Åæ„Çå„Çã„ÄÅ„ÇÇ„ÅÜ‰∏Ä„Å§„ÅÆ2026Âπ¥„Çí<br className="hidden md:block"/>
                                    È´òÂ∫¶„Å™ÈáèÂ≠ê„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅßÂèØË¶ñÂåñ„Åó„Åæ„Åô„ÄÇ
                                </p>
                                
                                <form onSubmit={handleSumbit} className="relative w-full max-w-2xl mb-8 group">
                                    <div className="absolute -inset-1 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-[2rem] blur opacity-15 group-hover:opacity-30 transition duration-700"></div>
                                    <input 
                                        type="text"
                                        value={input}
                                        onChange={(e) => setInput(e.target.value)}
                                        placeholder="„ÇÇ„Åó„ÇÇ„ÄÅ‚óã‚óã„Å†„Å£„Åü„ÇâÔºü"
                                        className="relative w-full bg-slate-900/90 border border-white/10 rounded-[2rem] px-8 py-5 text-lg focus:outline-none focus:border-cyan-500 transition-all shadow-xl"
                                    />
                                    <button 
                                        type="submit"
                                        disabled={loading}
                                        className="absolute right-2.5 top-2.5 bottom-2.5 bg-cyan-600 hover:bg-cyan-500 text-white px-8 rounded-2xl transition-all flex items-center justify-center shadow-lg active:scale-95 font-black text-base disabled:opacity-50"
                                    >
                                        Ë¶≥Ê∏¨ÈñãÂßã <Icon name="send" size={18} className="ml-2" />
                                    </button>
                                </form>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-left w-full max-w-2xl">
                                    {suggestions.map((suggestion, i) => (
                                        <button 
                                            key={i}
                                            onClick={() => setInput(suggestion)}
                                            className="p-3.5 bg-slate-900/40 border border-white/5 rounded-2xl hover:border-cyan-500/30 transition-all text-xs md:text-sm text-slate-400 flex items-center justify-between group hover:bg-slate-800/60"
                                        >
                                            <span className="font-medium truncate">{suggestion}</span>
                                            <Icon name="chevron-right" size={16} className="text-slate-700 group-hover:text-cyan-500 transition-colors flex-shrink-0 ml-2" />
                                        </button>
                                    ))}
                                </div>
                            </div>
                        ) : loading ? (
                            <div className="flex-grow flex flex-col items-center justify-center">
                                <div className="relative mb-10">
                                    <div className="w-32 h-32 border-[5px] border-cyan-500/10 border-t-cyan-500 rounded-full animate-spin"></div>
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <Icon name="cpu" size={48} className="text-cyan-500 animate-pulse" />
                                    </div>
                                </div>
                                <h3 className="text-2xl font-black text-white mb-2 tracking-widest text-center">ÊôÇÁ©∫„ÅÆÂÜçÊßãÊàê‰∏≠</h3>
                                <p className="text-slate-500 font-mono text-xs tracking-[0.4em] uppercase text-center">Calculating Reality Vectors...</p>
                            </div>
                        ) : (
                            <div className="animate-in fade-in duration-1000 pb-20">
                                <div className="bg-gradient-to-br from-slate-900 to-[#0d1117] border border-white/10 rounded-[3rem] p-8 md:p-12 mb-12 shadow-2xl flex flex-col md:flex-row items-center gap-8 md:gap-14 relative overflow-hidden">
                                   <div className="absolute top-0 right-0 p-12 opacity-[0.03] pointer-events-none scale-150">
                                     <Icon name="layout-grid" size={240} />
                                   </div>
                                   <div className="flex-shrink-0 text-center md:text-left relative z-10">
                                      <div className="text-sm font-black text-cyan-500 uppercase tracking-[0.3em] mb-2">Reality Deviation</div>
                                      <div className="text-7xl font-black text-white font-mono leading-none">{worldData.realityDeviation}<span className="text-4xl ml-1">%</span></div>
                                   </div>
                                   <div className="h-px md:h-24 w-full md:w-px bg-white/10"></div>
                                   <div className="flex-1 relative z-10">
                                      <h3 className="text-sm font-bold text-slate-500 uppercase tracking-[0.3em] mb-4 flex items-center gap-3">
                                        <Icon name="info" size={16} className="text-cyan-600" /> „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Â†±Âëä: 2026Âπ¥
                                      </h3>
                                      <p className="text-2xl md:text-3xl font-bold leading-tight text-slate-100">
                                        {worldData.worldSummary}
                                      </p>
                                   </div>
                                </div>

                                <div className="flex items-end justify-between mb-8 px-2">
                                   <h4 className="text-base font-black text-white uppercase tracking-[0.4em] border-l-4 border-cyan-600 pl-4">ÂàÜÈáéÂà•Ëß£Êûê</h4>
                                   <span className="text-slate-600 text-[10px] font-mono">SECTOR ANALYSIS</span>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20">
                                  {categories.map((cat) => (
                                    <div key={cat.id} className="bg-slate-900/30 border border-white/5 rounded-[2.5rem] overflow-hidden hover:border-cyan-500/40 transition-all flex flex-col group shadow-xl">
                                      {images[cat.id] ? (
                                        <img src={images[cat.id]} alt={cat.label} className="w-full h-56 object-cover group-hover:scale-110 transition-transform duration-1000" />
                                      ) : <SkeletonImage />}
                                      <div className="p-8 flex-1">
                                        <div className="flex items-center gap-3 mb-4">
                                          <span className="text-2xl">{cat.icon}</span>
                                          <span className="font-black text-lg text-white tracking-tight">{cat.label}</span>
                                        </div>
                                        <p className="text-lg text-slate-300 leading-relaxed font-medium">
                                          {worldData.categories?.[cat.id]?.content || "„Éá„Éº„Çø„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ"}
                                        </p>
                                      </div>
                                    </div>
                                  ))}
                                </div>

                                <div className="flex items-end justify-between mb-8 px-2">
                                   <h4 className="text-base font-black text-white uppercase tracking-[0.4em] border-l-4 border-orange-600 pl-4">‰∏ªË¶Å„Éà„Éî„ÉÉ„ÇØ„Çπ</h4>
                                   <span className="text-slate-600 text-[10px] font-mono">CRITICAL EVENTS</span>
                                </div>

                                <div className="space-y-12 mb-20">
                                  {worldData.topics?.map((topic, idx) => (
                                    <div key={idx} className="bg-slate-900/20 border border-white/5 rounded-[3.5rem] p-6 md:p-10 flex flex-col lg:flex-row gap-10 items-start group overflow-hidden relative shadow-2xl">
                                      <div className="w-full lg:w-[360px] aspect-square overflow-hidden rounded-[2.5rem] shadow-2xl flex-shrink-0">
                                        {images[`topic_${idx}`] ? (
                                          <img src={images[`topic_${idx}`]} alt={topic.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000" />
                                        ) : <SkeletonImage />}
                                      </div>
                                      <div className="flex-1 pt-4">
                                        <div className="inline-block bg-orange-600/10 text-orange-500 text-[10px] font-black px-4 py-1 rounded-full border border-orange-600/20 mb-5 uppercase tracking-[0.2em]">
                                          TOPIC OBSERVED #{idx + 1}
                                        </div>
                                        <h5 className="text-3xl md:text-4xl font-black text-white mb-6 group-hover:text-cyan-400 transition-colors leading-tight">{topic.title}</h5>
                                        <p className="text-xl md:text-2xl text-slate-300 leading-relaxed font-medium">
                                          {topic.detail}
                                        </p>
                                      </div>
                                      <div className="absolute -bottom-10 -right-10 text-white/[0.02] pointer-events-none">
                                        <Icon name="lightbulb" size={240} />
                                      </div>
                                    </div>
                                  ))}
                                </div>
                                
                                <button 
                                  onClick={() => { setWorldData(null); setInput(""); setImages({}); setError(null); setLoading(false); }}
                                  className="w-full py-10 border-4 border-dashed border-white/10 rounded-[3rem] text-slate-500 font-black text-lg uppercase tracking-[0.3em] hover:text-cyan-400 hover:border-cyan-500/50 hover:bg-cyan-500/5 transition-all flex items-center justify-center gap-4 group"
                                >
                                  <Icon name="refresh-cw" size={24} className="group-hover:rotate-180 transition-transform duration-1000 mr-4" /> Êñ∞„Åó„ÅÑ„Äå„ÇÇ„Åó„ÇÇ„Äç„ÇíË¶≥Ê∏¨
                                </button>
                            </div>
                        )}

                        {error && (
                            <div className="mt-8 p-6 bg-red-500/5 border border-red-500/20 rounded-[2rem] text-red-400 flex flex-col gap-4 shadow-2xl">
                                <div className="flex items-center gap-5">
                                    <Icon name="alert-triangle" size={28} />
                                    <div className="text-lg font-bold">Ë¶≥Ê∏¨„Ç®„É©„Éº</div>
                                </div>
                                <div className="whitespace-pre-wrap font-mono text-sm opacity-80">{error}</div>
                                <button 
                                    onClick={() => { setWorldData(null); setInput(""); setImages({}); setError(null); setLoading(false); }}
                                    className="bg-red-500/20 hover:bg-red-500/40 text-red-400 px-6 py-2 rounded-xl transition-colors font-bold self-start"
                                >
                                    „Éà„ÉÉ„Éó„Å∏Êàª„Çã
                                </button>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
